<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>M4U Scraper Tool</title>
  <style>
    body { font-family: sans-serif; margin: 16px; }
    .card { border: 1px solid #ddd; border-radius: 8px; padding: 12px; margin-bottom: 10px; }
    .btn { display: inline-block; background: #1976d2; color: #fff; padding: 6px 10px; border-radius: 4px; text-decoration: none; margin: 2px 4px; }
    .copy { background: #2e7d32; }
  </style>
</head>
<body>
  <h2>Movies4u Scraper Tool</h2>
  <input id="src" placeholder="Paste m4ulinks URL" style="width:100%;padding:8px;" />
  <button onclick="gen()" class="btn">Generate</button>
  <button onclick="copyAll()" class="btn copy">Copy All</button>
  <div id="out"></div>

<script>
async function gen() {
  const url = document.getElementById("src").value.trim();
  const res = await fetch("/api/generate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ url })
  });
  const data = await res.json();
  if (!data.ok) return alert("Error: " + data.error);

  let clip = "";
  const out = document.getElementById("out");
  out.innerHTML = "";

  for (const it of data.items) {
    clip += `${it.quality}\n`;
    for (const s of it.servers) clip += `[${s.server}] ${s.url}\n`;
    clip += "\n";

    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `<strong>${it.quality}</strong><br/>` +
      it.servers.map(s => `<a class="btn" href="${s.url}" target="_blank">${s.server}</a>`).join(" ");
    out.appendChild(div);
  }
  window._clip = clip;
}

async function copyAll() {
  if (!window._clip) return alert("Generate पहले करो");
  await navigator.clipboard.writeText(window._clip);
  alert("Copied!");
}
</script>
</body>
</html>
